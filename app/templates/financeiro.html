{% extends 'layout/base.html' %}

{% block title %}Frequência - Studio Fun{% endblock %}
{% block page_title %}Controle de Presença{% endblock %}

{% block content %}

<style>
    /* Estilo dos Badges de Status Financeiro */
.badge-finance {
    padding: 0.5em 0.8em;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

/* Em Dia - Verde */
.status-paid {
    background-color: #d1e7dd;
    color: #0f5132;
    border: 1px solid #badbcc;
}

/* Atrasado (até 90 dias) - Amarelo/Laranja */
.status-late {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeeba;
}

/* Inadimplente (> 90 dias) - Vermelho Crítico */
.status-default {
    background-color: #f8d7da;
    color: #842029;
    border: 1px solid #f5c2c7;
    animation: pulse-red 2s infinite;
}

/* Animação para chamar atenção aos inadimplentes que serão bloqueados */
@keyframes pulse-red {
    0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
    100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
}

/* Estilos Adicionais da Tabela */
#financialTableBody tr {
    transition: background-color 0.2s;
}

#financialTableBody td {
    padding: 1rem 0.75rem;
}

/* Customização dos botões de ação na tabela */
.btn-action-finance {
    width: 32px;
    height: 32px;
    padding: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: transform 0.2s;
}

.btn-action-finance:hover {
    transform: translateY(-2px);
}
.card {
    border-radius: 12px;
}

.card h6 {
    text-transform: uppercase;
    letter-spacing: 1px;
    font-size: 0.75rem;
    font-weight: 700;
}

.bg-primary { background: linear-gradient(45deg, #0d6efd, #0a58ca) !important; }
.bg-success { background: linear-gradient(45deg, #198754, #146c43) !important; }
.bg-warning { background: linear-gradient(45deg, #ffc107, #e0a800) !important; }
.bg-danger { background: linear-gradient(45deg, #dc3545, #bb2d3b) !important; }
</style>

<div class="container-fluid py-4">
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-primary text-white">
                <div class="card-body">
                    <h6 class="text-white-50">Receita do Mês</h6>
                    <h3 class="fw-bold mb-0" id="monthlyRevenue">R$ 0,00</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-success text-white">
                <div class="card-body">
                    <h6 class="text-white-50">Total Recebido</h6>
                    <h3 class="fw-bold mb-0" id="totalPaid">R$ 0,00</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-warning text-dark">
                <div class="card-body">
                    <h6 class="text-dark-50">Atrasados</h6>
                    <h3 class="fw-bold mb-0" id="totalLate">R$ 0,00</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-danger text-white">
                <div class="card-body">
                    <h6 class="text-white-50">Inadimplentes (>90 dias)</h6>
                    <h3 class="fw-bold mb-0" id="totalDefault">0 Alunos</h3>
                </div>
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-lg">
        <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-bold text-dark"><i class="fas fa-money-bill-wave me-2 text-success"></i>Controle de Mensalidades</h5>
            <div class="d-flex gap-2">
                <input type="text" id="searchFinancial" class="form-control form-control-sm" placeholder="Buscar aluno...">
                <select id="filterStatus" class="form-select form-select-sm">
                    <option value="">Todos os Status</option>
                    <option value="em_dia">Em Dia</option>
                    <option value="atrasado">Atrasado</option>
                    <option value="inadimplente">Inadimplente</option>
                </select>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light text-muted">
                    <tr>
                        <th>Aluno</th>
                        <th>Plano</th>
                        <th>Vencimento</th>
                        <th>Valor</th>
                        <th>Status</th>
                        <th class="text-center">Ações</th>
                    </tr>
                </thead>
                <tbody id="financialTableBody">
                    <tr>
                        <td colspan="6" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status"></div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="billingModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content border-0">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title">Gerar Cobrança</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4 text-center">
                <p id="billingInfo" class="text-muted"></p>
                <div class="d-grid gap-3">
                    <button class="btn btn-outline-primary py-3 fw-bold" onclick="generatePix()">
                        <i class="fab fa-pix me-2"></i>Gerar PIX QR-Code
                    </button>
                    <button class="btn btn-outline-secondary py-3 fw-bold" onclick="generateBoleto()">
                        <i class="fas fa-barcode me-2"></i>Gerar Boleto Bancário
                    </button>
                </div>
                <div id="qrCodeContainer" class="mt-4 d-none">
                    <img id="qrCodeImg" src="" class="img-fluid border p-2" style="max-width: 200px;">
                    <p class="small mt-2">Copia e Cola disponível</p>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/attendance.js') }}"></script>
{% endblock %}