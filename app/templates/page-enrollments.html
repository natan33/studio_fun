{% extends 'layout/base.html' %}

{% block title %}Matrículas - Studio Fun{% endblock %}
{% block page_title %}Gestão de Matrículas{% endblock %}

{% block content %}
<style>
    /* Garante que o select ocupe toda a largura do modal */
    .select2-container--bootstrap-5 {
        width: 100% !important;
    }

    /* Ajuste para o campo de seleção não ficar 'quebrado' visualmente */
    .select2-container .select2-selection--single {
        height: 38px !important;
        /* Altura padrão do Bootstrap */
        display: flex !important;
        align-items: center !important;

    }
</style>
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <h6 class="text-muted">Total de Matrículas</h6>
                <h2 class="fw-bold" id="card-total">0</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card shadow-sm border-0 border-start border-success border-4">
            <div class="card-body">
                <h6 class="text-muted">Matriculas Ativas</h6>
                <h2 class="fw-bold text-success" id="card-ativos">0</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card shadow-sm border-0 border-start border-warning border-4">
            <div class="card-body">
                <h6 class="text-muted">Matrículas Trancadas</h6>
                <h2 class="fw-bold text-warning" id="card-trancados">0</h2>
            </div>
        </div>
    </div>
</div>

<div class="row g-3 mb-4 align-items-end">
    <div class="col-md-5">
        <label class="form-label small fw-bold text-muted">BUSCAR ALUNO</label>
        <div class="input-group border rounded-pill px-3 py-1 bg-white shadow-sm">
            <span class="input-group-text bg-transparent border-0"><i class="fas fa-search text-muted"></i></span>
            <input type="text" id="filterStudent" class="form-control border-0 shadow-none"
                placeholder="Digite o nome...">
        </div>
    </div>

    <div class="col-md-4">
        <label class="form-label small fw-bold text-muted">ATIVIDADE</label>
        <select id="filterActivity" class="form-select border rounded-pill shadow-sm">
            <option value="">Todas Atividades</option>
        </select>
    </div>
    <div class="col-md-3">
        <label class="form-label small fw-bold text-muted">DATA DA MATRÍCULA</label>
        <input type="date" id="filterDate" class="form-control border rounded-pill shadow-sm">
    </div>

    <div class="d-flex justify-content-between align-items-center mt-3 px-3">
        <div id="paginationInfo" class="small text-muted"></div>
        <div id="paginationButtons" class="btn-group"></div>
    </div>

    <div class="col-md-3">
        <button class="btn btn-primary rounded-pill w-100 shadow-sm fw-bold" data-bs-toggle="modal"
            data-bs-target="#modalEnrollment">
            <i class="fas fa-plus-circle me-2"></i>Nova Matrícula
        </button>
    </div>
</div>

<div class="card border-0 shadow-sm">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table id="enrollmentsTable" class="table table-hover">
                <thead>
                    <tr>
                        <th>Aluno</th>
                        <th>Atividade / Horário</th>
                        <th>Data Matrícula</th>
                        <th>Status</th>
                        <th class="text-center">Ações</th>
                    </tr>
                </thead>
                <tbody id="enrollmentsBody"></tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="modalEnrollment" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title fw-bold"><i class="fas fa-signature me-2"></i>Nova Matrícula</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <form id="enrollmentForm">
                    {{ form.csrf_token }}
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase text-muted">Selecionar Aluno</label>
                        {{ form.student_id(class="form-select select2-modal", id='select-alunos') }}
                    </div>
                    <div class="mb-4">
                        <label class="form-label small fw-bold text-uppercase text-muted">Turma / Horário</label>
                        {{ form.schedule_id(class="form-select select2-schedule") }}
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary py-3 fw-bold shadow-sm">
                            Confirmar Matrícula
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/enrollments.js') }}"></script>
{% endblock %}